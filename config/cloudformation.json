{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "VPC" : {
       "Type" : "AWS::EC2::VPC",
       "Properties" : {
          "CidrBlock" : "192.168.0.0/16",
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemo2VPC"
            }
          ]
       }
    },
    "SubnetA" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "CidrBlock" : "192.168.1.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemo2SubnetA"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "SubnetB" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "CidrBlock" : "192.168.2.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemo2SubnetB"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "SubnetC" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1c",
         "CidrBlock" : "192.168.3.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "AirlineDemo2SubnetC"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "InternetGateway":{
      "Type" : "AWS::EC2::InternetGateway",
      "Properties" : {
        "Tags" : [
          {
            "Key": "Name",
            "Value": "AirlineDemo2InternetGateway"
          }
        ]
      }
    },
    "RouteTable" : {
      "Type" : "AWS::EC2::RouteTable",
      "Properties" : {
        "VpcId" : {"Ref": "VPC"},
        "Tags" : [
          {
            "Key": "Name",
            "Value" : "AirlineDemo2RouteTable"
          }
        ]
      }
    },
    "RouteToInternet" : {
      "Type" : "AWS::EC2::Route",
      "Properties" : {
        "DestinationCidrBlock" : "0.0.0.0/0",
        "GatewayId" : {"Ref": "InternetGateway"},
        "RouteTableId" : {"Ref":  "RouteTable"}
      },
      "DependsOn": ["VPCGatewayAttachment"]
    },
    "SubnetARouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetA"}
      }
    },
    "SubnetBRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetB"}
      }
    },
    "SubnetCRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetC"}
      }
    },
    "VPCGatewayAttachment":{
      "Type" : "AWS::EC2::VPCGatewayAttachment",
      "Properties" : {
         "InternetGatewayId" : {"Ref" : "InternetGateway"  },
         "VpcId" : {"Ref" : "VPC"}
      }
    },
    "SecurityGroup":{
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
         "GroupDescription" : "AirlineDemo2SecurityGroup",
         "VpcId" : {"Ref" : "VPC"},
         "SecurityGroupIngress" : [
            {
              "IpProtocol" : "-1",
               "CidrIp" : { "Fn::GetAtt": ["VPC","CidrBlock"]}
            },
            {
              "IpProtocol" : "tcp",
               "FromPort" : "22",
               "ToPort" : "22",
               "CidrIp" : "0.0.0.0/0"
            },
            {
              "IpProtocol" : "tcp",
               "FromPort" : "10000",
               "ToPort" : "19999",
               "CidrIp" : "0.0.0.0/0"
            }
          ],
          "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2SecurityGroup"
            }
          ]
      }

    },
    "gem1101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.large",
         "KeyName" : "yak-keypair",
         "PrivateIpAddress" : "192.168.1.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetA" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2Servergem1101"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo2"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-07c47bf39c036ef23"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-01f5e958eba409735"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-0dd14037fc81b7bc7"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "gem2101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.large",
         "KeyName" : "yak-keypair",
         "PrivateIpAddress" : "192.168.2.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2Servergem2101"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo2"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0f9284786dce0a48c"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-0f5ed25bb570a968a"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-0493738f4c977ff84"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "gem3101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1c",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.large",
         "KeyName" : "yak-keypair",
         "PrivateIpAddress" : "192.168.3.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetC" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2Servergem3101"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo2"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0d44540b19063e2f1"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-007729ca99e8a95b3"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-016b32b05ae2845be"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "etl2201" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.large",
         "KeyName" : "yak-keypair",
         "PrivateIpAddress" : "192.168.2.201",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2Serveretl2201"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo2"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-05e81338ac443bddf"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "web2201" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.large",
         "KeyName" : "yak-keypair",
         "PrivateIpAddress" : "192.168.2.202",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2Serverweb2201"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo2"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-01f5e136a1ed63d5f"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "controller" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "EbsOptimized" : false,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "t2.micro",
         "KeyName" : "yak-keypair",
         "PrivateIpAddress" : "192.168.1.222",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetA" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "AirlineDemo2Servercontroller"
            },
            {
              "Key": "Environment",
              "Value" : "AirlineDemo2"
            }
          ],
         "Volumes" : [
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
  },
  "Description": "AirlineDemo2 Stack"
}