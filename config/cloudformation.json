{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "VPC" : {
       "Type" : "AWS::EC2::VPC",
       "Properties" : {
          "CidrBlock" : "192.168.0.0/16",
          "Tags" : [
            {
              "Key": "Name",
              "Value": "GGreenVPC"
            }
          ]
       }
    },
    "SubnetA" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "CidrBlock" : "192.168.1.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "GGreenSubnetA"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "SubnetB" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "CidrBlock" : "192.168.2.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "GGreenSubnetB"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "SubnetC" : {
      "Type" : "AWS::EC2::Subnet",
      "Properties" : {
         "AvailabilityZone" : "us-east-1c",
         "CidrBlock" : "192.168.3.0/24",
         "MapPublicIpOnLaunch" : true,
          "Tags" : [
            {
              "Key": "Name",
              "Value": "GGreenSubnetC"
            }
          ],
         "VpcId" : { "Ref" : "VPC" }
      }
    },
    "InternetGateway":{
      "Type" : "AWS::EC2::InternetGateway",
      "Properties" : {
        "Tags" : [
          {
            "Key": "Name",
            "Value": "GGreenInternetGateway"
          }
        ]
      }
    },
    "RouteTable" : {
      "Type" : "AWS::EC2::RouteTable",
      "Properties" : {
        "VpcId" : {"Ref": "VPC"},
        "Tags" : [
          {
            "Key": "Name",
            "Value" : "GGreenRouteTable"
          }
        ]
      }
    },
    "RouteToInternet" : {
      "Type" : "AWS::EC2::Route",
      "Properties" : {
        "DestinationCidrBlock" : "0.0.0.0/0",
        "GatewayId" : {"Ref": "InternetGateway"},
        "RouteTableId" : {"Ref":  "RouteTable"}
      },
      "DependsOn": ["VPCGatewayAttachment"]
    },
    "SubnetARouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetA"}
      }
    },
    "SubnetBRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetB"}
      }
    },
    "SubnetCRouteTableAssociation" : {
      "Type" : "AWS::EC2::SubnetRouteTableAssociation",
      "Properties" : {
         "RouteTableId" : {"Ref" : "RouteTable"},
         "SubnetId" : {"Ref" : "SubnetC"}
      }
    },
    "VPCGatewayAttachment":{
      "Type" : "AWS::EC2::VPCGatewayAttachment",
      "Properties" : {
         "InternetGatewayId" : {"Ref" : "InternetGateway"  },
         "VpcId" : {"Ref" : "VPC"}
      }
    },
    "SecurityGroup":{
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
         "GroupDescription" : "GGreenSecurityGroup",
         "VpcId" : {"Ref" : "VPC"},
         "SecurityGroupIngress" : [
            {
              "IpProtocol" : "-1",
               "CidrIp" : { "Fn::GetAtt": ["VPC","CidrBlock"]}
            },
            {
              "IpProtocol" : "tcp",
               "FromPort" : "22",
               "ToPort" : "22",
               "CidrIp" : "0.0.0.0/0"
            },
            {
              "IpProtocol" : "tcp",
               "FromPort" : "10000",
               "ToPort" : "19999",
               "CidrIp" : "0.0.0.0/0"
            }
          ],
          "Tags" : [
            {
              "Key": "Name",
              "Value" : "GGreenSecurityGroup"
            }
          ]
      }

    },
    "gem1101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.xlarge",
         "KeyName" : "ggreenpivotalio",
         "PrivateIpAddress" : "192.168.1.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetA" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "GGreenServergem1101"
            },
            {
              "Key": "Environment",
              "Value" : "GGreen"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0b5a057f1854bde44"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-0b16047749b6689a9"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-0951729c9797e8abc"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "gem2101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1b",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.xlarge",
         "KeyName" : "ggreenpivotalio",
         "PrivateIpAddress" : "192.168.2.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetB" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "GGreenServergem2101"
            },
            {
              "Key": "Environment",
              "Value" : "GGreen"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0444598029135a3ef"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-08eca95fc3642c481"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-01d342af3fdbd4e1b"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "gem3101" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1c",
         "EbsOptimized" : true,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "m4.xlarge",
         "KeyName" : "ggreenpivotalio",
         "PrivateIpAddress" : "192.168.3.101",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetC" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "GGreenServergem3101"
            },
            {
              "Key": "Environment",
              "Value" : "GGreen"
            }
          ],
         "Volumes" : [
          {
            "Device" : "/dev/xvdf",
            "VolumeId" : "vol-0ab6917607af97a5d"
          }
,          {
            "Device" : "/dev/xvdg",
            "VolumeId" : "vol-090192cb886a2e7bf"
          }
,          {
            "Device" : "/dev/xvdh",
            "VolumeId" : "vol-0d13b7460017b1bf5"
          }
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
,     "controller" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
         "AvailabilityZone" : "us-east-1a",
         "EbsOptimized" : false,
         "ImageId" : "ami-0b33d91d",
         "InstanceInitiatedShutdownBehavior" : "stop",
         "InstanceType" : "t2.micro",
         "KeyName" : "ggreenpivotalio",
         "PrivateIpAddress" : "192.168.1.222",
         "SecurityGroupIds" : [ { "Ref" : "SecurityGroup"}],
         "SubnetId" : { "Ref" : "SubnetA" },
         "Tags" : [
            {
              "Key": "Name",
              "Value" : "GGreenServercontroller"
            },
            {
              "Key": "Environment",
              "Value" : "GGreen"
            }
          ],
         "Volumes" : [
         ] ,
         "BlockDeviceMappings" : [
         ]
      }
    }
  },
  "Description": "GGreen Stack"
}