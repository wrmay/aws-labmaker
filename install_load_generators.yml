---
-   hosts: etls
    become: no
    vars:
        ansible_ssh_user: ec2-user 
    tasks:
        -   name: install required software 
            become: yes
            yum: 
                name: ['java-1.8.0-openjdk-devel.x86_64', 'nc', 'git','lsof','rsync']
        
        -   name: disable iptables
            become: yes
            service: 
                name: iptables
                enabled: no 
                state: stopped
        
        -   name: download and unpack GemFire 9.3 
            become: no
            unarchive:
                remote_src: yes
                src: http://download.pivotal.com.s3.amazonaws.com/gemfire/9.3.0/pivotal-gemfire-9.3.0.zip
                dest: /runtime
                owner: ec2-user
                group: ec2-user
                
        -   name: create GemFire symbolic link
            become: no 
            file: 
                path: /runtime/gemfire 
                src: /runtime/pivotal-gemfire-9.3.0
                state: link
                owner: ec2-user 
                group: ec2-user 
                
        -   name: download and unpack Maven
            become: no
            unarchive:
                remote_src: yes
                src:  http://apache.cs.utah.edu/maven/maven-3/3.6.0/binaries/apache-maven-3.6.0-bin.tar.gz
                dest: /runtime
                owner: ec2-user
                group: ec2-user
                
        -   name: create Maven symbolic link
            become: no 
            file: 
                path: /runtime/maven 
                src: /runtime/apache-maven-3.6.0
                remote_src: yes
                state: link
                owner: ec2-user 
                group: ec2-user 

        -   name: configure the bash profile 
            become: no 
            copy: 
                src: setuptasks/ConfigureProfile/bash_profile 
                dest: /home/ec2-user/.bash_profile 
                owner: ec2-user 
                group: ec2-user 
                
        -   name: configure maven 
            become: no
            copy:
                src: setuptasks/ConfigureMaven/settings.xml 
                dest: /home/ec2-user/.m2/
                owner: ec2-user 
                group: ec2-user 
        
        -   name: copy the load-generator project up
            become: no
            copy:
                src: ../load-generator
                dest: /runtime
                owner: ec2-user
                group: ec2-user
            
        -   name: build it 
            become: no
            command: /runtime/maven/bin/mvn package
            args:
                chdir: /runtime/load-generator
                    
